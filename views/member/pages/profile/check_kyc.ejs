<%- include('../../../partials/header.ejs') %>

  <section class="content inbox">
    <br>
    <div class="block-header" style="margin-top: 15px;">
        <div class="row">
            <div class="col-lg-7 col-md-6 col-sm-12">
                                <h2 style="color: black;">KYC Upload
                    <small class="text-muted">Welcome to Novax-Assets</small>
                </h2>
            </div>
            <div class="col-lg-5 col-md-6 col-sm-12">
                <ul class="breadcrumb float-md-right">
                    <li class="breadcrumb-item" style="color: #2ca8ff;"><a href=""><i class="zmdi zmdi-home"></i> Home </a>
                    </li>
                    <li class="breadcrumb-item" style="color: grey;"><a href="javascript:void(0);">KYC Upload</a>
                    </li>

                </ul>
            </div>
        </div>
    </div>
    <div class="container-fluid">

        <div class="row clearfix">
          <div id="message"></div>
            <div class="col-lg-12">
                <div class="card">
                    <form method="POST" enctype="multipart/form-data" id="myForm">
                        <div class="body">
                            <div class="row">
                                <div class="col-md-12 col-lg-12 col-xl-12">
                                    <div class="form-group form-float">
                                        <small>Passport</small>
                                        <input type="file"  name="kyc" class="form-control" required placeholder="To:">
                                    </div>
                                    <div class="form-group form-float">
                                        <small>Id Card</small>
                                        <input type="file" name="kyc" class="form-control" required placeholder="Subject">
                                    </div>
                                    <div class="form-group form-float">
                                        <small>Id Card Back</small>
                                        <input type="file" name="kyc" class="form-control" required placeholder="Subject">
                                    </div>
                                    <div class="form-group form-float">
                                        <small>Passport Back</small>
                                        <input type="file" name="kyc" class="form-control" required placeholder="Subject">
                                    </div>
                                </div>
                                <div class="col-md-12 col-lg-12 col-xl-12">
                                  

                           <button type="submit" name="submit" value="submit" class="btn btn-primary btn-round waves-effect m-t-20">Upload KYC</button>
                              </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            
        </div>
        <div class="container-fluid">
        <div class="row clearfix">
          <div class="col-lg-12">
            
            <div class="tab-content">
              <div
                role="tabpanel"
                class="tab-pane in active"
                id="details"
                aria-expanded="true"
              >
                <div class="card" id="details">
                  <div class="body">
                    <div class="row">
                      <div class="col-md-6 col-sm-6">
                        
                      </div>
                      <div class="col-md-6 col-sm-6 text-right">

                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12">
                      <h2>KYC</h2>  
                        <div class="table-responsive">
                          
                          <table
                            id="mainTable"
                            class="table table-striped"
                            style="cursor: pointer"
                          >
                            <thead>
                              <tr>

                                <th>First</th>
                                <th>Second</th>
                                <th>Third</th>
                                <th>Fourth</th>
                                <th>Status</th>
                                <th>Date</th>
                              </tr>
                            </thead>
                                                            <tbody>
  <% if (kyc) { %>
    <tr>
      <td>
        <% if (kyc.first) { %>
          <a href="<%= kyc.first %>" target="_blank" rel="noopener">
            <img src="<%= kyc.first %>" alt="KYC first" style="max-width:140px;max-height:90px;object-fit:cover;border:1px solid #ddd;display:block;margin-bottom:6px" />
          </a>
        <% } %>
        
      </td>

      <td>
        <% if (kyc.second) { %>
          <a href="<%= kyc.second %>" target="_blank" rel="noopener">
            <img src="<%= kyc.second %>" alt="KYC second" style="max-width:140px;max-height:90px;object-fit:cover;border:1px solid #ddd;display:block;margin-bottom:6px" />
          </a>
        <% } %>
        
      </td>

      <td>
        <% if (kyc.third) { %>
          <a href="<%= kyc.third %>" target="_blank" rel="noopener">
            <img src="<%= kyc.third %>" alt="KYC third" style="max-width:140px;max-height:90px;object-fit:cover;border:1px solid #ddd;display:block;margin-bottom:6px" />
          </a>
        <% } %>
        
      </td>

      <td>
        <% if (kyc.fourth) { %>
          <a href="<%= kyc.fourth %>" target="_blank" rel="noopener">
            <img src="<%= kyc.fourth %>" alt="KYC fourth" style="max-width:140px;max-height:90px;object-fit:cover;border:1px solid #ddd;display:block;margin-bottom:6px" />
          </a>
        <% } %>
      
      </td>

      <td><%= kyc.status || '-' %></td>
      <td><%= kyc.date.toLocaleDateString() || '-' %></td>
    </tr>
  <% } else { %>
    <tr>
      <td colspan="7" class="alert alert-warning text-dark" style="text-align: center;">No Data Yet</td>
    </tr>
  <% } %>
</tbody>

                                                          </table>
                        
                      
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <script>
        const myForm = document.getElementById('myForm');
        myForm.addEventListener('submit', function(event) {
    event.preventDefault();
     const messageDiv = document.getElementById('message');
    messageDiv.innerHTML = '';
    const formData = new FormData(this);
    fetch('/member/account/profile/upload_kyc', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        console.log('Success:', data);
        messageDiv.innerHTML = `<div class="bg-green-100 border border-green-200 text-green-700 px-3 py-2 rounded relative mb-4" style="background-color: green;" role="alert">
            <span class="block sm:inline font-semibold" style="color:white">KYC Uploaded successfully!</span>
        </div>`;
        window.location.reload();
    })
    .catch(error => {
       messageDiv.innerHTML = `<div class="bg-red-100 border border-red-200 text-red-700 px-3 py-2 rounded relative mb-4" style="background-color: red;" role="alert">
            <span class="block sm:inline font-semibold" style="color:white">Error uploading KYC documents!</span>
        </div>`;
        console.error('Error:', error);
    });
});
      </script>

  <%- include('../../../partials/footer.ejs') %>