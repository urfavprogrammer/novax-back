  <%- include('../../../partials/header.ejs') %>

  <section class="content profile-page">
      <div class="block-header" style="padding-top: 45px;">
        <div class="row">
          <div class="col-lg-7 col-md-6 col-sm-12">
            <h2 style="color: black;">
              Profile
              <small class="text-muted">Welcome to Novax-Assets</small>
            </h2>
          </div>
          <div class="col-lg-5 col-md-6 col-sm-12">
            <ul class="breadcrumb float-md-right">
              <li class="breadcrumb-item" style="color: #2ca8ff;">
                <a href="/member/account/dashboard"><i class="zmdi zmdi-home"></i> Home</a>
              </li>
             
              <li class="breadcrumb-item active">User Change Password</li>
            </ul>
          </div>
        </div>
      </div>
      <div class="container-fluid">
        <div class="row clearfix">
          <div class="col-lg-4 col-md-12">
            <div class="card member-card">
              <div class="header l-cyan">
                <h2 class="m-t-10"><%=user.fullname%></h2>
              </div>
              <div class="member-img">
                <a href="/member/account/change_password" class="">
                  <img
                    src="<%= user.avatarUrl %>"
                    class="rounded-circle"
                    alt="profile-image"
                  />
                </a>
              </div>
              <div class="body">
                <div class="col-12" style="margin-top:30px">
                  <%= user.email %>
                  <!-- <ul class="social-links list-unstyled">
                    <li>
                      <a title="facebook" href="#"
                        ><i class="zmdi zmdi-facebook"></i
                      ></a>
                    </li>
                    <li>
                      <a title="twitter" href="#"
                        ><i class="zmdi zmdi-twitter"></i
                      ></a>
                    </li>
                    <li>
                      <a title="instagram" href="#"
                        ><i class="zmdi zmdi-instagram"></i
                      ></a>
                    </li>
                  </ul> -->
                  <p class="text-muted">
                    <%= user.country %>                  </p>
                </div>

              </div>
            </div>
           
          </div>
          <div class="col-lg-8 col-md-12">
            <!-- <div class="card">
              <ul class="nav nav-tabs">
                <li class="nav-item">
                  <a class="nav-link active" data-toggle="tab" href="#mypost"
                    >Setting</a
                  >
                </li>
                
              </ul>
            </div> -->
            <div class="tab-content">
           


              <div role="tabpanel" class="tab-pane active" id="usersettings">
                <div id="message"></div>
                <form enctype="multipart/form-data" id="form3">
                <div class="card">
                  <div class="header">
               
                                      <h2><strong>User</strong> Password</h2>
                                      
              
            
                  </div>

                
                  <div class="body">
                    <div class="form-group">
                      <input
                        type="text" name="oldpass"
                        value=""
                        class="form-control"
                        placeholder="Old Password"
                        autocomplete="off"
                        required
                      />
                    </div>
                    <div class="form-group">
                      <input
                        type="text" name="pass"
                        value=''
                        class="form-control"
                        placeholder="New Password"
                        autocomplete="off"
                        required
                      />
                    </div>
                    <div class="form-group">
                      <input 
                        type="text" class="form-control" name="cpass"
                        value=''
                        placeholder="Confirm New Password"
                        autocomplete="off"
                        required
                      />
                      
                    </div>
                    </div>
                     <div class="col-md-12">
                    <button type="submit" value="submit" name="submit" class="btn btn-info btn-round">Change Password</button>
                  </div>
                  </div>
                  </form>
                </div>
              
              </div>
            </div>
          </div>
        </div>
        
        <script>

          const form3 = document.getElementById('form3');
          const submitBtn = form3.querySelector('button[type="submit"]');
          form3.addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent default form submission
            const oldpass = document.getElementsByName('oldpass')[0].value;
            const pass = document.getElementsByName('pass')[0].value;
            const cpass = document.getElementsByName('cpass')[0].value;
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = ''; // Clear previous messages
            submitBtn.textContent = 'Please wait...';
            submitBtn.disabled = true;

            if (!oldpass || !pass || !cpass) {// Prevent form submission
              alert('All fields are required.');
              return;
            }

            if (pass !== cpass) { // Prevent form submission
              alert('New Password and Confirm New Password do not match.');
              return;
            }

            // Optionally, add more validation rules here (e.g., password strength)

            // If all validations pass, the form will be submitted
           try{ fetch('/auth/change_password', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ oldpass, pass, cpass })
            }).then(response => response.json())
              .then(data => {
                if (data.success) {
                  messageDiv.innerHTML = `<div class="bg-green-100 border border-green-200 text-green-700 px-3 py-2 rounded relative mb-4" style="background-color: green;" role="alert">
            <span class="block sm:inline font-semibold" style="color:white">Password changed successfully!</span>
        </div>`;
                  // Optionally, redirect or clear the form

                } else if (data.error) {
                  messageDiv.innerHTML = `<div class="bg-red-100 border border-red-200 text-red-700 px-3 py-2 rounded relative mb-4" style="background-color: red;" role="alert">
            <span class="block sm:inline font-semibold" style="color:white">Error: ${data.message}</span>
        </div>`;
                } else {
                  messageDiv.innerHTML = `<div class="bg-red-100 border border-red-200 text-red-700 px-3 py-2 rounded relative mb-4" style="background-color: red;" role="alert">
            <span class="block sm:inline font-semibold" style="color:white">Error: ${data.message}</span>
        </div>`;
                }
              })


            } catch(error) {
                console.error('Error:', error);
                messageDiv.innerHTML = '<div class="card-text" id="message" style="color: red; text-align: center;">An error occurred while changing the password.</div>';
              }
              finally{
                submitBtn.textContent = 'Change Password';
                submitBtn.disabled = false;
                messageDiv.innerHTML = '';
                form3.reset();
              }
          });

        </script>


  <%- include('../../../partials/footer.ejs') %>